# SimilarCode
 
 ## Getting started

1. Download StackOverflow database

- Go to https://archive.org/details/stackexchange.
- Download [stackoverflow.com-Posts.7z](https://archive.org/download/stackexchange/stackoverflow.com-Posts.7z).

Optional: extract the downloaded file.

2. Download TXL

Download TXL at https://www.txl.ca/ and decompress the directory. Installation is optional.

3. Download NiCad

Note: only the NiCad TXL grammars are used from this application and not the NiCad matcher.

- Go to https://www.txl.ca/txl-nicaddownload.html.
- Select "gzipped tar (.tar.gz) source with Makefile".
- Select "I agree" if you agree to the terms and conditions.
- Download the .tar.gz file.
- Decompress the downloaded .tar.gz file.
- In the decompressed folder at `NiCad-x.y/txl`, optionally remove any programming language grammars that you do not want to detect. Removing grammars can greatly improve database creation performance but will cause the database to mark any languages not detected as "Other" and they won't be parsed.

4. Convert the StackOverflow database into a SimilarCode database

Depending on your computer, it could take eight hours to a couple of days.

- Open the SimilarCode.sln project in Visual Studio.
- Build the SimilarCode.Load.Cli project, and publish it. It also works on Linux and in some cases can be faster under WSL2.
- Run `SimilarCode.Load.Cli.exe -p /path/to/stackoverflow.com-Posts.7z -x /path/to/txl.exe -g ~/workspace/path/to/NiCad-x.y/txl -o /path/to/output/similarcode/database.db`. You can replace `/path/to/stackoverflow.com-Posts.7z` with the path to the decompressed file if you have decompressed it. The output file is not compressed and could be several gigabytes.

5. Match your code against the SimilarCode database

- Open the SimilarCode.sln project in Visual Studio.
- Build the SimilarCode.Match.Cli project, and publish it. It also works on Linux and in some cases can be faster under WSL2.
- Run `SimilarCode.Match.Cli.exe -p /path/to/output/similarcode/database.db -- /path/to/file/or/folder/to/match`. Results are output to stdout by default.

Add-Migration NewMigration -Project SimilarCode.Load (from SimilarCode.Load.Cli default project)

## It's not working correctly. How does it work?

The SimilarCode database is a SQLite database generated by Entity Core. The SimilarCode database is generated by:
- Detecting the programming languages of each StackOverflow answer by parsing it with every TXL grammar. Only code in code blocks are parsed, and each code block is considered a separate snippet. The snippets are deconstructed into functions if possible, or code blocks if the function parsing does not work.
- If a programming language could not be determined, then the snippet is stored as-is (with minimal whitespace adjustments.)
- Only snippets above a certain line threshold are saved. The code is formatted using the formatting guidelines from the TXL grammar.
- A programming language snippet could have multiple matching grammars, and must be syntactically valid. In this context, "syntactically" means that the TXL grammar must be able to parse it; it is possible that a syntax update to a programming language could cause the StackOverflow answer to not be parsed. In the future, a best-effort approach could be used to detect unknown programming language snippets.

The matcher detects similar code snippets by:
- Parsing the input code using the TXL grammar so that it can be formatted in a manner consistent with the other snippets. If the code cannot be compiled or does not match the TXL grammar, then there is a lower chance that it could be matched because it might not be formatted correctly. If the TXL stacksize is exceeded, then TXL will crash and not match the snippet. The stacksize can be increased using the `editbin` command. Please note that increasing it too much could cause large files or files that are not syntaxically valid to use excessive amounts of CPU/memory.
- The matcher algorithm compares this snippet against the next entry in the database and assigns it a score. Only the top _n_ snippet URLs are saved and then presented to the user.